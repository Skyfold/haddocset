<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/TypeLits.hs</title>
<link type="text/css" rel="stylesheet" href="hscolour.css"></link>
</head>
<body>
<pre><a name="line-1"></a><span class="hs-comment">{-# LANGUAGE DataKinds #-}</span>              <span class="hs-comment">-- to declare the kinds</span>
<a name="line-2"></a><span class="hs-comment">{-# LANGUAGE KindSignatures #-}</span>         <span class="hs-comment">-- (used all over)</span>
<a name="line-3"></a><span class="hs-comment">{-# LANGUAGE TypeFamilies #-}</span>           <span class="hs-comment">-- for declaring operators + sing family</span>
<a name="line-4"></a><span class="hs-comment">{-# LANGUAGE TypeOperators #-}</span>          <span class="hs-comment">-- for declaring operator</span>
<a name="line-5"></a><span class="hs-comment">{-# LANGUAGE EmptyDataDecls #-}</span>         <span class="hs-comment">-- for declaring the kinds</span>
<a name="line-6"></a><span class="hs-comment">{-# LANGUAGE GADTs #-}</span>                  <span class="hs-comment">-- for examining type nats</span>
<a name="line-7"></a><span class="hs-comment">{-# LANGUAGE PolyKinds #-}</span>              <span class="hs-comment">-- for Sing family</span>
<a name="line-8"></a><span class="hs-comment">{-# LANGUAGE UndecidableInstances #-}</span>   <span class="hs-comment">-- for a bunch of the instances</span>
<a name="line-9"></a><span class="hs-comment">{-# LANGUAGE FlexibleInstances #-}</span>      <span class="hs-comment">-- for kind parameters</span>
<a name="line-10"></a><span class="hs-comment">{-# LANGUAGE FlexibleContexts #-}</span>       <span class="hs-comment">-- for kind parameters</span>
<a name="line-11"></a><span class="hs-comment">{-# LANGUAGE ScopedTypeVariables #-}</span>    <span class="hs-comment">-- for kind parameters</span>
<a name="line-12"></a><span class="hs-comment">{-# LANGUAGE MultiParamTypeClasses #-}</span>  <span class="hs-comment">-- for &lt;=, singRep, SingE</span>
<a name="line-13"></a><span class="hs-comment">{-# LANGUAGE FunctionalDependencies #-}</span> <span class="hs-comment">-- for SingRep and SingE</span>
<a name="line-14"></a><span class="hs-comment">{-# OPTIONS_GHC -XNoImplicitPrelude #-}</span>
<a name="line-15"></a><span class="hs-comment">{-| This module is an internal GHC module.  It declares the constants used
<a name="line-16"></a>in the implementation of type-level natural numbers.  The programmer interface
<a name="line-17"></a>for workin with type-level naturals should be defined in a separate library. -}</span>
<a name="line-18"></a>
<a name="line-19"></a><span class="hs-keyword">module</span> <span class="hs-conid">GHC</span><span class="hs-varop">.</span><span class="hs-conid">TypeLits</span>
<a name="line-20"></a>  <span class="hs-layout">(</span> <span class="hs-comment">-- * Kinds</span>
<a name="line-21"></a>    <span class="hs-conid">Nat</span><span class="hs-layout">,</span> <span class="hs-conid">Symbol</span>
<a name="line-22"></a>
<a name="line-23"></a>    <span class="hs-comment">-- * Linking type and value level</span>
<a name="line-24"></a>  <span class="hs-layout">,</span> <span class="hs-conid">Sing</span><span class="hs-layout">,</span> <span class="hs-conid">SingI</span><span class="hs-layout">,</span> <span class="hs-conid">SingE</span><span class="hs-layout">,</span> <span class="hs-conid">SingRep</span><span class="hs-layout">,</span> <span class="hs-varid">sing</span><span class="hs-layout">,</span> <span class="hs-varid">fromSing</span>
<a name="line-25"></a>  <span class="hs-layout">,</span> <span class="hs-varid">unsafeSingNat</span><span class="hs-layout">,</span> <span class="hs-varid">unsafeSingSymbol</span>
<a name="line-26"></a>  <span class="hs-layout">,</span> <span class="hs-conid">Kind</span>
<a name="line-27"></a>
<a name="line-28"></a>    <span class="hs-comment">-- * Working with singletons</span>
<a name="line-29"></a>  <span class="hs-layout">,</span> <span class="hs-varid">withSing</span><span class="hs-layout">,</span> <span class="hs-varid">singThat</span>
<a name="line-30"></a>
<a name="line-31"></a>    <span class="hs-comment">-- * Functions on type nats</span>
<a name="line-32"></a>  <span class="hs-layout">,</span> <span class="hs-keyword">type</span> <span class="hs-layout">(</span><span class="hs-varop">&lt;=</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-keyword">type</span> <span class="hs-layout">(</span><span class="hs-varop">&lt;=?</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-keyword">type</span> <span class="hs-layout">(</span><span class="hs-varop">+</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-keyword">type</span> <span class="hs-layout">(</span><span class="hs-varop">*</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-keyword">type</span> <span class="hs-layout">(</span><span class="hs-varop">^</span><span class="hs-layout">)</span>
<a name="line-33"></a>
<a name="line-34"></a>    <span class="hs-comment">-- * Destructing type-nats.</span>
<a name="line-35"></a>  <span class="hs-layout">,</span> <span class="hs-varid">isZero</span><span class="hs-layout">,</span> <span class="hs-conid">IsZero</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span>
<a name="line-36"></a>  <span class="hs-layout">,</span> <span class="hs-varid">isEven</span><span class="hs-layout">,</span> <span class="hs-conid">IsEven</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span>
<a name="line-37"></a>  <span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-38"></a>
<a name="line-39"></a><span class="hs-keyword">import</span> <span class="hs-conid">GHC</span><span class="hs-varop">.</span><span class="hs-conid">Base</span><span class="hs-layout">(</span><span class="hs-conid">Eq</span><span class="hs-layout">(</span><span class="hs-layout">(</span><span class="hs-varop">==</span><span class="hs-layout">)</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-conid">Bool</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-layout">(</span><span class="hs-varop">$</span><span class="hs-layout">)</span><span class="hs-layout">,</span> <span class="hs-varid">otherwise</span><span class="hs-layout">,</span> <span class="hs-layout">(</span><span class="hs-varop">.</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-40"></a><span class="hs-keyword">import</span> <span class="hs-conid">GHC</span><span class="hs-varop">.</span><span class="hs-conid">Num</span><span class="hs-layout">(</span><span class="hs-conid">Integer</span><span class="hs-layout">,</span> <span class="hs-layout">(</span><span class="hs-comment">-</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-41"></a><span class="hs-keyword">import</span> <span class="hs-conid">GHC</span><span class="hs-varop">.</span><span class="hs-conid">Base</span><span class="hs-layout">(</span><span class="hs-conid">String</span><span class="hs-layout">)</span>
<a name="line-42"></a><span class="hs-keyword">import</span> <span class="hs-conid">GHC</span><span class="hs-varop">.</span><span class="hs-conid">Read</span><span class="hs-layout">(</span><span class="hs-conid">Read</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-43"></a><span class="hs-keyword">import</span> <span class="hs-conid">GHC</span><span class="hs-varop">.</span><span class="hs-conid">Show</span><span class="hs-layout">(</span><span class="hs-conid">Show</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-44"></a><span class="hs-keyword">import</span> <span class="hs-conid">GHC</span><span class="hs-varop">.</span><span class="hs-conid">Prim</span><span class="hs-layout">(</span><span class="hs-conid">Any</span><span class="hs-layout">)</span>
<a name="line-45"></a><span class="hs-keyword">import</span> <span class="hs-conid">Unsafe</span><span class="hs-varop">.</span><span class="hs-conid">Coerce</span><span class="hs-layout">(</span><span class="hs-varid">unsafeCoerce</span><span class="hs-layout">)</span>
<a name="line-46"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Bits</span><span class="hs-layout">(</span><span class="hs-varid">testBit</span><span class="hs-layout">,</span><span class="hs-varid">shiftR</span><span class="hs-layout">)</span>
<a name="line-47"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Maybe</span><span class="hs-layout">(</span><span class="hs-conid">Maybe</span><span class="hs-layout">(</span><span class="hs-keyglyph">..</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-48"></a><span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">List</span><span class="hs-layout">(</span><span class="hs-layout">(</span><span class="hs-varop">++</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-49"></a>
<a name="line-50"></a><a name="Kind"></a><span class="hs-comment">-- | A type synonym useful for passing kinds as parameters.</span>
<a name="line-51"></a><a name="Kind"></a><span class="hs-keyword">type</span> <span class="hs-conid">Kind</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Any</span>
<a name="line-52"></a>
<a name="line-53"></a>
<a name="line-54"></a><a name="Nat"></a><span class="hs-comment">-- | This is the *kind* of type-level natural numbers.</span>
<a name="line-55"></a><a name="Nat"></a><span class="hs-keyword">data</span> <span class="hs-conid">Nat</span>
<a name="line-56"></a>
<a name="line-57"></a><a name="Symbol"></a><span class="hs-comment">-- | This is the *kind* of type-level symbols.</span>
<a name="line-58"></a><a name="Symbol"></a><span class="hs-keyword">data</span> <span class="hs-conid">Symbol</span>
<a name="line-59"></a>
<a name="line-60"></a>
<a name="line-61"></a><span class="hs-comment">--------------------------------------------------------------------------------</span>
<a name="line-62"></a><span class="hs-keyword">data</span> <span class="hs-varid">family</span> <span class="hs-conid">Sing</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span>
<a name="line-63"></a>
<a name="line-64"></a><span class="hs-keyword">newtype</span> <span class="hs-keyword">instance</span> <span class="hs-conid">Sing</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span>    <span class="hs-keyglyph">=</span> <span class="hs-conid">SNat</span> <span class="hs-conid">Integer</span>
<a name="line-65"></a>
<a name="line-66"></a><span class="hs-keyword">newtype</span> <span class="hs-keyword">instance</span> <span class="hs-conid">Sing</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Symbol</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">SSym</span> <span class="hs-conid">String</span>
<a name="line-67"></a>
<a name="line-68"></a><a name="unsafeSingNat"></a><span class="hs-definition">unsafeSingNat</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Integer</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Sing</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span>
<a name="line-69"></a><span class="hs-definition">unsafeSingNat</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">SNat</span>
<a name="line-70"></a>
<a name="line-71"></a><a name="unsafeSingSymbol"></a><span class="hs-definition">unsafeSingSymbol</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">String</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Sing</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Symbol</span><span class="hs-layout">)</span>
<a name="line-72"></a><span class="hs-definition">unsafeSingSymbol</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">SSym</span>
<a name="line-73"></a>
<a name="line-74"></a><span class="hs-comment">--------------------------------------------------------------------------------</span>
<a name="line-75"></a>
<a name="line-76"></a><span class="hs-comment">-- | The class 'SingI' provides a \&quot;smart\&quot; constructor for singleton types.</span>
<a name="line-77"></a><span class="hs-comment">-- There are built-in instances for the singleton types corresponding</span>
<a name="line-78"></a><span class="hs-comment">-- to type literals.</span>
<a name="line-79"></a>
<a name="line-80"></a><a name="SingE"></a><span class="hs-keyword">class</span> <span class="hs-conid">SingI</span> <span class="hs-varid">a</span> <span class="hs-keyword">where</span>
<a name="line-81"></a>
<a name="line-82"></a>  <span class="hs-comment">-- | The only value of type @Sing a@</span>
<a name="line-83"></a>  <span class="hs-varid">sing</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Sing</span> <span class="hs-varid">a</span>
<a name="line-84"></a>
<a name="line-85"></a><a name="SingE"></a><span class="hs-comment">--------------------------------------------------------------------------------</span>
<a name="line-86"></a><a name="SingE"></a><span class="hs-comment">-- | Comparsion of type-level naturals.</span>
<a name="line-87"></a><a name="SingE"></a><span class="hs-keyword">class</span> <span class="hs-layout">(</span><span class="hs-varid">m</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-varop">&lt;=</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span>
<a name="line-88"></a>
<a name="line-89"></a><span class="hs-keyword">type</span> <span class="hs-varid">family</span> <span class="hs-layout">(</span><span class="hs-varid">m</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-varop">&lt;=?</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Bool</span>
<a name="line-90"></a>
<a name="line-91"></a><span class="hs-comment">-- | Addition of type-level naturals.</span>
<a name="line-92"></a><span class="hs-keyword">type</span> <span class="hs-varid">family</span> <span class="hs-layout">(</span><span class="hs-varid">m</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-varop">+</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span>
<a name="line-93"></a>
<a name="line-94"></a><span class="hs-comment">-- | Multiplication of type-level naturals.</span>
<a name="line-95"></a><span class="hs-keyword">type</span> <span class="hs-varid">family</span> <span class="hs-layout">(</span><span class="hs-varid">m</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-varop">*</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span>
<a name="line-96"></a>
<a name="line-97"></a><span class="hs-comment">-- | Exponentiation of type-level naturals.</span>
<a name="line-98"></a><span class="hs-keyword">type</span> <span class="hs-varid">family</span> <span class="hs-layout">(</span><span class="hs-varid">m</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-varop">^</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span>
<a name="line-99"></a>
<a name="line-100"></a>
<a name="line-101"></a><span class="hs-comment">--------------------------------------------------------------------------------</span>
<a name="line-102"></a>
<a name="line-103"></a><span class="hs-comment">{- | A class that converts singletons of a given kind into values of some
<a name="line-104"></a>representation type (i.e., we &quot;forget&quot; the extra information carried
<a name="line-105"></a>by the singletons, and convert them to ordinary values).
<a name="line-106"></a>
<a name="line-107"></a>Note that 'fromSing' is overloaded based on the /kind/ of the values
<a name="line-108"></a>and not their type---all types of a given kind are processed by the
<a name="line-109"></a>same instances.
<a name="line-110"></a>-}</span>
<a name="line-111"></a>
<a name="line-112"></a><a name="SingE"></a><span class="hs-keyword">class</span> <span class="hs-layout">(</span><span class="hs-varid">kparam</span> <span class="hs-keyglyph">~</span> <span class="hs-conid">Kind</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">SingE</span> <span class="hs-layout">(</span><span class="hs-varid">kparam</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span> <span class="hs-varid">rep</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">kparam</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">rep</span> <span class="hs-keyword">where</span>
<a name="line-113"></a>  <span class="hs-varid">fromSing</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Sing</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">rep</span>
<a name="line-114"></a>
<a name="line-115"></a><a name="instance%20SingE%20(Kind%20::%20Nat)%20Integer"></a><span class="hs-keyword">instance</span> <span class="hs-conid">SingE</span> <span class="hs-layout">(</span><span class="hs-conid">Kind</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span><span class="hs-layout">)</span> <span class="hs-conid">Integer</span> <span class="hs-keyword">where</span>
<a name="line-116"></a>  <span class="hs-varid">fromSing</span> <span class="hs-layout">(</span><span class="hs-conid">SNat</span> <span class="hs-varid">n</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">n</span>
<a name="line-117"></a>
<a name="line-118"></a><a name="instance%20SingE%20(Kind%20::%20Symbol)%20String"></a><span class="hs-keyword">instance</span> <span class="hs-conid">SingE</span> <span class="hs-layout">(</span><span class="hs-conid">Kind</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Symbol</span><span class="hs-layout">)</span> <span class="hs-conid">String</span> <span class="hs-keyword">where</span>
<a name="line-119"></a>  <span class="hs-varid">fromSing</span> <span class="hs-layout">(</span><span class="hs-conid">SSym</span> <span class="hs-varid">s</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">s</span>
<a name="line-120"></a>
<a name="line-121"></a>
<a name="line-122"></a><a name="SingRep"></a><span class="hs-comment">{- | A convenience class, useful when we need to both introduce and eliminate
<a name="line-123"></a>a given singleton value. Users should never need to define instances of
<a name="line-124"></a>this classes. -}</span>
<a name="line-125"></a><a name="SingRep"></a><span class="hs-keyword">class</span>    <span class="hs-layout">(</span><span class="hs-conid">SingI</span> <span class="hs-varid">a</span><span class="hs-layout">,</span> <span class="hs-conid">SingE</span> <span class="hs-layout">(</span><span class="hs-conid">Kind</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span> <span class="hs-varid">rep</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">SingRep</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span> <span class="hs-varid">rep</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">rep</span>
<a name="line-126"></a><a name="instance%20SingRep%20(a%20::%20k)%20rep%20%7b-%20%7c%20A%20convenience%20function%20useful%20when%20we%20need%20to%20name%20a%20singleton%20value%20multiple%20times.%20Without%20this%20function,%20each%20use%20of%20'sing'%20could%20potentially%20refer%20to%20a%20different%20singleton,%20and%20one%20has%20to%20use%20type%20signatures%20to%20ensure%20that%20they%20are%20the%20same.%20-%7d%20withSing%20::%20SingI%20a%20=%3e%20(Sing%20a%20-%3e%20b)%20-%3e%20b%20withSing%20f%20=%20f%20sing%20%7b-%20%7c%20A%20convenience%20function%20that%20names%20a%20singleton%20satisfying%20a%20certain%20property.%20If%20the%20singleton%20does%20not%20satisfy%20the%20property,%20then%20the%20function%20returns%20'Nothing'.%20The%20property%20is%20expressed%20in%20terms%20of%20the%20underlying%20representation%20of%20the%20singleton.%20-%7d%20singThat%20::%20(SingRep%20a%20rep)%20=%3e%20(rep%20-%3e%20Bool)%20-%3e%20Maybe%20(Sing%20a)%20singThat%20p%20=%20withSing%20$%20%5cx%20-%3e%20if%20p%20(fromSing%20x)%20then%20Just%20x%20else%20Nothing%20instance%20(SingE%20(Kind%20::%20k)%20rep,%20Show%20rep)%20=%3e%20Show%20(Sing%20(a%20::%20k))"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">SingI</span> <span class="hs-varid">a</span><span class="hs-layout">,</span> <span class="hs-conid">SingE</span> <span class="hs-layout">(</span><span class="hs-conid">Kind</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span> <span class="hs-varid">rep</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">SingRep</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span> <span class="hs-varid">rep</span>
<a name="line-127"></a>
<a name="line-128"></a>
<a name="line-129"></a><span class="hs-comment">{- | A convenience function useful when we need to name a singleton value
<a name="line-130"></a>multiple times.  Without this function, each use of 'sing' could potentially
<a name="line-131"></a>refer to a different singleton, and one has to use type signatures to
<a name="line-132"></a>ensure that they are the same. -}</span>
<a name="line-133"></a>
<a name="line-134"></a><a name="withSing"></a><span class="hs-definition">withSing</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">SingI</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-layout">(</span><span class="hs-conid">Sing</span> <span class="hs-varid">a</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varid">b</span>
<a name="line-135"></a><span class="hs-definition">withSing</span> <span class="hs-varid">f</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">f</span> <span class="hs-varid">sing</span>
<a name="line-136"></a>
<a name="line-137"></a>
<a name="line-138"></a><span class="hs-comment">{- | A convenience function that names a singleton satisfying a certain
<a name="line-139"></a>property.  If the singleton does not satisfy the property, then the function
<a name="line-140"></a>returns 'Nothing'. The property is expressed in terms of the underlying
<a name="line-141"></a>representation of the singleton. -}</span>
<a name="line-142"></a>
<a name="line-143"></a><a name="singThat"></a><span class="hs-definition">singThat</span> <span class="hs-keyglyph">::</span> <span class="hs-layout">(</span><span class="hs-conid">SingRep</span> <span class="hs-varid">a</span> <span class="hs-varid">rep</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-layout">(</span><span class="hs-varid">rep</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Bool</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">Maybe</span> <span class="hs-layout">(</span><span class="hs-conid">Sing</span> <span class="hs-varid">a</span><span class="hs-layout">)</span>
<a name="line-144"></a><span class="hs-definition">singThat</span> <span class="hs-varid">p</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">withSing</span> <span class="hs-varop">$</span> <span class="hs-keyglyph">\</span><span class="hs-varid">x</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyword">if</span> <span class="hs-varid">p</span> <span class="hs-layout">(</span><span class="hs-varid">fromSing</span> <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-keyword">then</span> <span class="hs-conid">Just</span> <span class="hs-varid">x</span> <span class="hs-keyword">else</span> <span class="hs-conid">Nothing</span>
<a name="line-145"></a>
<a name="line-146"></a>
<a name="line-147"></a>
<a name="line-148"></a><a name="instance%20Show%20(Sing%20(a%20::%20k))"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">SingE</span> <span class="hs-layout">(</span><span class="hs-conid">Kind</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span> <span class="hs-varid">rep</span><span class="hs-layout">,</span> <span class="hs-conid">Show</span> <span class="hs-varid">rep</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Show</span> <span class="hs-layout">(</span><span class="hs-conid">Sing</span> <span class="hs-layout">(</span><span class="hs-varid">a</span> <span class="hs-keyglyph">::</span> <span class="hs-varid">k</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-149"></a>  <span class="hs-varid">showsPrec</span> <span class="hs-varid">p</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">showsPrec</span> <span class="hs-varid">p</span> <span class="hs-varop">.</span> <span class="hs-varid">fromSing</span>
<a name="line-150"></a>
<a name="line-151"></a><a name="instance%20Read%20(Sing%20a)"></a><span class="hs-keyword">instance</span> <span class="hs-layout">(</span><span class="hs-conid">SingRep</span> <span class="hs-varid">a</span> <span class="hs-varid">rep</span><span class="hs-layout">,</span> <span class="hs-conid">Read</span> <span class="hs-varid">rep</span><span class="hs-layout">,</span> <span class="hs-conid">Eq</span> <span class="hs-varid">rep</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=&gt;</span> <span class="hs-conid">Read</span> <span class="hs-layout">(</span><span class="hs-conid">Sing</span> <span class="hs-varid">a</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-152"></a>  <span class="hs-varid">readsPrec</span> <span class="hs-varid">p</span> <span class="hs-varid">cs</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">do</span> <span class="hs-layout">(</span><span class="hs-varid">x</span><span class="hs-layout">,</span><span class="hs-varid">ys</span><span class="hs-layout">)</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">readsPrec</span> <span class="hs-varid">p</span> <span class="hs-varid">cs</span>
<a name="line-153"></a>                      <span class="hs-keyword">case</span> <span class="hs-varid">singThat</span> <span class="hs-layout">(</span><span class="hs-varop">==</span> <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-keyword">of</span>
<a name="line-154"></a>                        <span class="hs-conid">Just</span> <span class="hs-varid">y</span>  <span class="hs-keyglyph">-&gt;</span> <span class="hs-keyglyph">[</span><span class="hs-layout">(</span><span class="hs-varid">y</span><span class="hs-layout">,</span><span class="hs-varid">ys</span><span class="hs-layout">)</span><span class="hs-keyglyph">]</span>
<a name="line-155"></a>                        <span class="hs-conid">Nothing</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">[]</span>
<a name="line-156"></a>
<a name="line-157"></a>
<a name="line-158"></a>
<a name="line-159"></a><a name="IsZero"></a><span class="hs-comment">--------------------------------------------------------------------------------</span>
<a name="line-160"></a><a name="IsZero"></a><span class="hs-keyword">data</span> <span class="hs-conid">IsZero</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varop">*</span> <span class="hs-keyword">where</span>
<a name="line-161"></a>  <span class="hs-conid">IsZero</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">IsZero</span> <span class="hs-num">0</span>
<a name="line-162"></a>  <span class="hs-conid">IsSucc</span> <span class="hs-keyglyph">::</span> <span class="hs-varop">!</span><span class="hs-layout">(</span><span class="hs-conid">Sing</span> <span class="hs-varid">n</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">IsZero</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-varop">+</span> <span class="hs-num">1</span><span class="hs-layout">)</span>
<a name="line-163"></a>
<a name="line-164"></a><a name="isZero"></a><span class="hs-definition">isZero</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Sing</span> <span class="hs-varid">n</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">IsZero</span> <span class="hs-varid">n</span>
<a name="line-165"></a><span class="hs-definition">isZero</span> <span class="hs-layout">(</span><span class="hs-conid">SNat</span> <span class="hs-varid">n</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">n</span> <span class="hs-varop">==</span> <span class="hs-num">0</span>    <span class="hs-keyglyph">=</span> <span class="hs-varid">unsafeCoerce</span> <span class="hs-conid">IsZero</span>
<a name="line-166"></a>                <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">unsafeCoerce</span> <span class="hs-layout">(</span><span class="hs-conid">IsSucc</span> <span class="hs-layout">(</span><span class="hs-conid">SNat</span> <span class="hs-layout">(</span><span class="hs-varid">n</span><span class="hs-comment">-</span><span class="hs-num">1</span><span class="hs-layout">)</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-167"></a>
<a name="line-168"></a><a name="instance%20Show%20(IsZero%20n)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">Show</span> <span class="hs-layout">(</span><span class="hs-conid">IsZero</span> <span class="hs-varid">n</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-169"></a>  <span class="hs-varid">show</span> <span class="hs-conid">IsZero</span>     <span class="hs-keyglyph">=</span> <span class="hs-str">&quot;0&quot;</span>
<a name="line-170"></a>  <span class="hs-varid">show</span> <span class="hs-layout">(</span><span class="hs-conid">IsSucc</span> <span class="hs-varid">n</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-str">&quot;(&quot;</span> <span class="hs-varop">++</span> <span class="hs-varid">show</span> <span class="hs-varid">n</span> <span class="hs-varop">++</span> <span class="hs-str">&quot; + 1)&quot;</span>
<a name="line-171"></a>
<a name="line-172"></a><a name="IsEven"></a><span class="hs-keyword">data</span> <span class="hs-conid">IsEven</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Nat</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-varop">*</span> <span class="hs-keyword">where</span>
<a name="line-173"></a>  <span class="hs-conid">IsEvenZero</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">IsEven</span> <span class="hs-num">0</span>
<a name="line-174"></a>  <span class="hs-conid">IsEven</span>     <span class="hs-keyglyph">::</span> <span class="hs-varop">!</span><span class="hs-layout">(</span><span class="hs-conid">Sing</span> <span class="hs-layout">(</span><span class="hs-varid">n</span><span class="hs-varop">+</span><span class="hs-num">1</span><span class="hs-layout">)</span><span class="hs-layout">)</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">IsEven</span> <span class="hs-layout">(</span><span class="hs-num">2</span> <span class="hs-varop">*</span> <span class="hs-varid">n</span> <span class="hs-varop">+</span> <span class="hs-num">2</span><span class="hs-layout">)</span>
<a name="line-175"></a>  <span class="hs-conid">IsOdd</span>      <span class="hs-keyglyph">::</span> <span class="hs-varop">!</span><span class="hs-layout">(</span><span class="hs-conid">Sing</span> <span class="hs-varid">n</span><span class="hs-layout">)</span>     <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">IsEven</span> <span class="hs-layout">(</span><span class="hs-num">2</span> <span class="hs-varop">*</span> <span class="hs-varid">n</span> <span class="hs-varop">+</span> <span class="hs-num">1</span><span class="hs-layout">)</span>
<a name="line-176"></a>
<a name="line-177"></a><a name="isEven"></a><span class="hs-definition">isEven</span> <span class="hs-keyglyph">::</span> <span class="hs-conid">Sing</span> <span class="hs-varid">n</span> <span class="hs-keyglyph">-&gt;</span> <span class="hs-conid">IsEven</span> <span class="hs-varid">n</span>
<a name="line-178"></a><span class="hs-definition">isEven</span> <span class="hs-layout">(</span><span class="hs-conid">SNat</span> <span class="hs-varid">n</span><span class="hs-layout">)</span> <span class="hs-keyglyph">|</span> <span class="hs-varid">n</span> <span class="hs-varop">==</span> <span class="hs-num">0</span>      <span class="hs-keyglyph">=</span> <span class="hs-varid">unsafeCoerce</span> <span class="hs-conid">IsEvenZero</span>
<a name="line-179"></a>                <span class="hs-keyglyph">|</span> <span class="hs-varid">testBit</span> <span class="hs-varid">n</span> <span class="hs-num">0</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">unsafeCoerce</span> <span class="hs-layout">(</span><span class="hs-conid">IsOdd</span>  <span class="hs-layout">(</span><span class="hs-conid">SNat</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-varop">`shiftR`</span> <span class="hs-num">1</span><span class="hs-layout">)</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-180"></a>                <span class="hs-keyglyph">|</span> <span class="hs-varid">otherwise</span>   <span class="hs-keyglyph">=</span> <span class="hs-varid">unsafeCoerce</span> <span class="hs-layout">(</span><span class="hs-conid">IsEven</span> <span class="hs-layout">(</span><span class="hs-conid">SNat</span> <span class="hs-layout">(</span><span class="hs-varid">n</span> <span class="hs-varop">`shiftR`</span> <span class="hs-num">1</span><span class="hs-layout">)</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
<a name="line-181"></a>
<a name="line-182"></a><a name="instance%20Show%20(IsEven%20n)"></a><span class="hs-keyword">instance</span> <span class="hs-conid">Show</span> <span class="hs-layout">(</span><span class="hs-conid">IsEven</span> <span class="hs-varid">n</span><span class="hs-layout">)</span> <span class="hs-keyword">where</span>
<a name="line-183"></a>  <span class="hs-varid">show</span> <span class="hs-conid">IsEvenZero</span> <span class="hs-keyglyph">=</span> <span class="hs-str">&quot;0&quot;</span>
<a name="line-184"></a>  <span class="hs-varid">show</span> <span class="hs-layout">(</span><span class="hs-conid">IsEven</span> <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-str">&quot;(2 * &quot;</span> <span class="hs-varop">++</span> <span class="hs-varid">show</span> <span class="hs-varid">x</span> <span class="hs-varop">++</span> <span class="hs-str">&quot;)&quot;</span>
<a name="line-185"></a>  <span class="hs-varid">show</span> <span class="hs-layout">(</span><span class="hs-conid">IsOdd</span>  <span class="hs-varid">x</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-str">&quot;(2 * &quot;</span> <span class="hs-varop">++</span> <span class="hs-varid">show</span> <span class="hs-varid">x</span> <span class="hs-varop">++</span> <span class="hs-str">&quot; + 1)&quot;</span>
<a name="line-186"></a>
<a name="line-187"></a>
</pre></body>
</html>
